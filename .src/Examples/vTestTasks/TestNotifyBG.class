' Gambas class file

Inherits Task
Public MyFile As File
Public Cycles As Integer = 10
Public LogFileName As String = User.home &/ "Desktop/gambas.BGLogFile.txt"

Public Sub main() As Integer

  MyFile = Open LogFileName For Write Create

  Print #MyFile, "BG: Testing Change notify Function ", Application.id

  SharedMem.NotifyChange("WaitTest", Me, -1)
  Print #MyFile, "BG: Added Notify Request for when Variable 'WaitTest' Changes"

  Print #MyFile, "BG: Start count at "; SharedMem!WaitTest;; "for";; Cycles;; "Cycles"
  Wait 1

  For i As Integer = 1 To Cycles
    Print #MyFile, "BG: Inc the Variable 'WaitTest' to "; SharedMem!WaitTest + 1
    Inc SharedMem!WaitTest
    Wait 0.01
  Next

  Print #MyFile, "BG: Exit"
  Wait 0.5

  SharedMem.NotifyCancel("WaitTest", Me)

  Print "BG Exit"

  Return 0

Catch

  Print #MyFile, "BG: Error ", Error.text, Error.where
  Quit 0

End

Public Sub WaitTest_changed(NewValue As Variant, Optional Symname As Variant)

  'Print #myFile, "BG: wait test changed ", NewValue
  Print #MyFile, "BG: Recieved Notice that Variable "; Quote(SymName); " changed ", NewValue
  Flush

End

